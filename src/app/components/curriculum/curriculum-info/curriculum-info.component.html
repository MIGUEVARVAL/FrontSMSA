<main class="body">



    <div class="col d-flex flex-column gap-3 p-4">

        <nav aria-label="breadcrumb" class="p-3">
            <ol class="breadcrumb m-0">
                <li class="breadcrumb-item"><a routerLink="/home">Inicio</a></li>
                <li class="breadcrumb-item"><a routerLink="/curriculum/curriculum-list">Listado de planes de estudio</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Información del plan de estudio</li>
            </ol>
        </nav>

        <div class="d-flex flex-grow-1 row m-0 p-4 p-xl-8 gx-4 gy-4 gy-xl-0 bg-neutral-95">

            @if (planEstudio) {

            <div class="col body flex-grow-1">

                <div class="vstack gap-4 flex-grow-1">
                    <div class="bg-neutral-95 h-100 rounded-5 ">

                        <div class="bg-neutral-100 rounded-4 bar text-center p-5 my-5">
                            <h4>{{planEstudio.codigo}} - {{planEstudio.nombre}}</h4>

                        </div>

                        <div class="row">
                            <div class="col mb-4">
                                @if (planEstudio.activo) {
                                <div
                                    class="bg-success-99 border-success-80 border-2 border h-100 w-100 rounded-5 text-center p-3">
                                    <h4 class="text-success">Plan de estudios activo </h4>
                                </div>
                                } @else {
                                <div
                                    class="bg-neutral-90 border-neutral-75 border-2 border h-100 w-100 rounded-5 text-center p-3">
                                    <h4 class="text-neutral">Plan de estudios inactivo </h4>
                                </div>
                                }
                            </div>
                        </div>

                        <div
                            class="row row-cols-2 row-cols-sm-3 row-cols-lg-3 row-cols-xxl-3 g-4 justify-content-center">
                            <div class="col">

                                <div class="card border-0 px-1 py-1 mw-100 h-100 text-center" data-bs-toggle="collapse"
                                    href="#collapseInformacion" role="button" aria-expanded="false"
                                    aria-controls="collapseInformacion">
                                    <div class="row d-block h-100">
                                        <div class="col d-flex justify-content-center align-items-center pt-4">
                                            <div class="bg-primary-90 rounded-circle p-2 d-flex">
                                                <span translate='no'
                                                    class="material-symbols-outlined lh-1 icon-md text-primary-30">description</span>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="card-body">
                                                <div class="card-stack gap-0 m-0">
                                                    <h2>Información</h2>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="card border-0 px-1 py-1 mw-100 h-100 text-center" data-bs-toggle="collapse"
                                    href="#collapseAsignaturas" role="button" aria-expanded="false"
                                    aria-controls="collapseAsignaturas">
                                    <div class="row d-block h-100">
                                        <div class="col d-flex justify-content-center align-items-center pt-4">
                                            <div class="bg-primary-90 rounded-circle p-2 d-flex">
                                                <span translate='no'
                                                    class="material-symbols-outlined lh-1 icon-md text-primary-30">book_5</span>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="card-body">
                                                <div class="card-stack gap-0 m-0">
                                                    <h2>Asignaturas</h2>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="card border-0 px-1 py-1 mw-100 h-100 text-center" data-bs-toggle="collapse"
                                    href="#collapseAcuerdos" role="button" aria-expanded="false"
                                    aria-controls="collapseAcuerdos">
                                    <div class="row d-block h-100">
                                        <div class="col d-flex justify-content-center align-items-center pt-4">
                                            <div class="bg-primary-90 rounded-circle p-2 d-flex">
                                                <span translate='no'
                                                    class="material-symbols-outlined lh-1 icon-md text-primary-30">inventory</span>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="card-body">
                                                <div class="card-stack gap-0 m-0">
                                                    <h2>Acuerdos</h2>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr class="hr my-4">

                        @if (isSuccess) {
                        <div class="alert alert-success">
                            <div class="alert-header">
                                <div class="alert-icon">
                                    <span class="material-symbols-outlined">info</span>
                                </div>
                                <div class="alert-title">
                                    {{successMessage}}
                                </div>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"
                                    aria-label="Close"></button>
                            </div>
                        </div>
                        }

                        @if (isError) {
                        <div class="alert alert-danger">
                            <div class="alert-header">
                                <div class="alert-icon">
                                    <span class="material-symbols-outlined">info</span>
                                </div>
                                <div class="alert-title">
                                    {{errorMessage}}
                                </div>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"
                                    aria-label="Close"></button>
                            </div>
                        </div>
                        }


                        <div id="accordionCurriculum">
                            <div class="collapse show" id="collapseInformacion" data-bs-parent="#accordionCurriculum">
                                <div class="bg-neutral-100 rounded-5 p-5 my-2">
                                    <div class="p-4">
                                        <div class="row row-cols-1 row-cols-md-2 gx-4 mb-5">

                                            <div class="col my-3">
                                                <div class="border-start px-3 mw-100 h-100">
                                                    <div class="card-body">
                                                        <div class="card-stack gap-0 m-0">
                                                            <p class="fw-regular">Facultad</p>
                                                            <h5>
                                                                {{planEstudio.facultad.nombre}}
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col my-3">
                                                <div class="border-start px-3 mw-100 h-100">
                                                    <div class="card-body">
                                                        <div class="card-stack gap-0 m-0">
                                                            <p class="fw-regular">Tipo nivel</p>
                                                            <h5>
                                                                {{planEstudio.tipo_nivel}}
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col my-3">
                                                <div class="border-start px-3 mw-100 h-100">
                                                    <div class="card-body">
                                                        <div class="card-stack gap-0 m-0">
                                                            <p class="fw-regular">Nivel</p>
                                                            <h5>
                                                                {{planEstudio.nivel}}
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col my-3">
                                                <div class="border-start px-3  mw-100 h-100">
                                                    <div class="card-body">
                                                        <div class="card-stack gap-0 m-0">
                                                            <p class="fw-regular">SNIES</p>
                                                            <h5>
                                                                {{planEstudio.snies}}
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col my-3">
                                                <div class="border-start px-3  mw-100 h-100">
                                                    <div class="card-body">
                                                        <div class="card-stack gap-0 m-0">
                                                            <p class="fw-regular">Plan reformado</p>
                                                            <h5>
                                                                {{planEstudio.plan_reformado ? 'Sí' : 'No'}}
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            @if (planEstudio.puntos) {
                                            <div class="col my-3">
                                                <div class="border-start px-3  mw-100 h-100">
                                                    <div class="card-body">
                                                        <div class="card-stack gap-0 m-0">
                                                            <p class="fw-regular">Puntos</p>
                                                            <h5>
                                                                {{planEstudio.puntos}}
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            }
                                            @if (planEstudio.inicio_extincion) {
                                            <div class="col my-3">
                                                <div class="border-start px-3  mw-100 h-100">
                                                    <div class="card-body">
                                                        <div class="card-stack gap-0 m-0">
                                                            <p class="fw-regular">Periodo de inicio de extinción</p>
                                                            <h5>
                                                                {{planEstudio.inicio_extincion}}
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            }
                                            @if (planEstudio.extincion_definitiva) {
                                            <div class="col my-3">
                                                <div class="border-start px-3  mw-100 h-100">
                                                    <div class="card-body">
                                                        <div class="card-stack gap-0 m-0">
                                                            <p class="fw-regular">Periodo de extinción definitiva</p>
                                                            <h5>
                                                                {{planEstudio.extincion_definitiva}}
                                                            </h5>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            }

                                        </div>


                                    </div>
                                </div>
                            </div>

                            <div class="collapse" id="collapseAsignaturas" data-bs-parent="#accordionCurriculum">
                                <div class="bg-neutral-100 rounded-5 p-4 my-2">

                                    <h4 class="text-center p-4">Asignaturas del plan de estudio</h4>
                                    <div class="accordion" id="accordionAsignaturas">

                                        @for (tipologia of tipologias; track $index) {

                                        <div class="accordion-item rounded-3">
                                            <h2 class="accordion-header" [id]="'heading-tipologia-'+tipologia.id">
                                                <button class="accordion-button " type="button"
                                                    data-bs-toggle="collapse"
                                                    [attr.data-bs-target]="'#collapse-tipologia-'+tipologia.id"
                                                    aria-expanded=" true"
                                                    [attr.aria-controls]="'collapse-tipologia-'+tipologia.id">
                                                    {{tipologia.nombre}} ({{tipologia.asignaturas.length}} asignaturas)
                                                </button>
                                            </h2>


                                            <div [id]="'collapse-tipologia-'+tipologia.id"
                                                class="accordion-collapse collapse show ">
                                                <div class="accordion-body">

                                                    <div
                                                        class="row row-cols-1 row-cols-sm-2 row-cols-md-4 row-cols-lg-5 g-4 ">

                                                        @for (asignatura of tipologia.asignaturas; track $index) {

                                                        <div class="col">
                                                            <div class="card px-3 py-1 mw-100 h-100 rounded-diag-secondary border-0"
                                                                [class]="tipologia.codigo === 'O' || tipologia.codigo === 'B' ? 'bg-tertiary-purple-99':
                                                                tipologia.codigo === 'T' || tipologia.codigo === 'P' || tipologia.codigo === 'C' ? 'bg-secondary-99':
                                                                tipologia.codigo === 'L' || tipologia.codigo === 'U' ? 'bg-warning-99'
                                                                 : 'bg-tertiary-blue-99'">
                                                                <div class="card-body">
                                                                    <div class="card-stack gap-0 m-0">

                                                                        <div
                                                                            class="d-flex justify-content-between my-2">
                                                                            <div class="item-flex">
                                                                                {{asignatura.codigo}}</div>
                                                                            <div class="item-flex fw-regular"><span
                                                                                    class="tag tag-neutral">{{asignatura.creditos}}
                                                                                    créditos</span>
                                                                            </div>
                                                                        </div>

                                                                        <p class="fw-regular"></p>
                                                                        <p>{{asignatura.nombre}}</p>
                                                                        <p class="small text-neutral-60 fw-regular">
                                                                            Tipología:
                                                                            {{tipologia.codigo}} - {{tipologia.nombre}}
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        }
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        }

                                    </div>
                                </div>
                            </div>

                            <div class="collapse" id="collapseAcuerdos" data-bs-parent="#accordionCurriculum">
                                <div class="bg-neutral-100 rounded-5 p-4 my-2">

                                    <div class="p-2 float-end">
                                        <div class="toolbar sm bg-fixed-success" role="group" aria-label="btn-groups">
                                            <a type="button" class="btn btn-icon" data-bs-toggle="modal"
                                                [attr.data-bs-target]="'#addAcuerdoModal'">
                                                <span class='material-symbols-fill'>add</span>
                                            </a>
                                        </div>
                                    </div>

                                    <div class="modal fade" tabindex="-1" [attr.id]="'addAcuerdoModal'">
                                        <div class="modal-dialog modal-xl modal-dialog-scrollable">
                                            <div class="modal-content">
                                                <form [formGroup]="createAcuerdoForm" (ngSubmit)="onCreateAcuerdo()">
                                                    <div class="modal-header">
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-title">Edición de la asignatura</div>
                                                    <div class="modal-body overflow-scroll" style="max-height: 70vh;">
                                                        <div class="my-2 ">
                                                            <div class="p-4">
                                                                <p>Titulo</p>
                                                                <input type="text" formControlName="titulo"
                                                                    class="form-control">
                                                            </div>
                                                            <div class="p-4">
                                                                <p>URL</p>
                                                                <input type="url" formControlName="link"
                                                                    class="form-control">
                                                            </div>
                                                            <div class="p-4">
                                                                <p>Vigencia</p>
                                                                <select name="vigente" id="vigente"
                                                                    formControlName="vigente" class="form-select">
                                                                    <option value="true">Acuerdo Vigente</option>
                                                                    <option value="false">Acuerdo no Vigente
                                                                    </option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer mt-4">
                                                        <button type="button" class="btn btn-outline-primary"
                                                            data-bs-dismiss="modal">
                                                            Cancelar
                                                        </button>
                                                        <button type="submit" class="btn btn-primary"
                                                            data-bs-dismiss="modal">
                                                            Crear acuerdo
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>

                                    <h4 class="text-center p-4">Acuerdos del plan de estudio</h4>
                                    @if (acuerdos.length > 0) {


                                    <table class="table table-hover align-middle">
                                        <thead>
                                            <tr>
                                                <th>Título</th>
                                                <th>Estado</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @for (acuerdo of acuerdos; track $index) {
                                            <tr>
                                                <td>
                                                    <a [href]="acuerdo.link" target="_blank">{{ acuerdo.titulo }}</a>
                                                </td>
                                                <td>
                                                    <span class="tag"
                                                        [ngClass]="{'tag-success': acuerdo.vigente, 'tag-neutral': !acuerdo.vigente}">
                                                        {{ acuerdo.vigente ? 'Vigente' : 'No Vigente' }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <div class="toolbar sm bg-fixed-warning" role="group"
                                                        aria-label="Basic example">
                                                        <a type="button" class="btn btn-icon" data-bs-toggle="modal"
                                                            [attr.data-bs-target]="'#editAcuerdoModal'"
                                                            (click)="prepareEditAcuerdo(acuerdo)">
                                                            <span translate="no"
                                                                class="material-symbols-fill">edit</span>
                                                        </a>
                                                    </div>

                                                    <div class="toolbar sm bg-fixed-danger" role="group"
                                                        aria-label="Basic example">
                                                        <a type="button" class="btn btn-icon" data-bs-toggle="tooltip"
                                                            data-bs-title="Añadir"
                                                            (click)="onDeleteAcuerdo(acuerdo.id)">
                                                            <span translate="no"
                                                                class="material-symbols-fill">delete</span>
                                                        </a>
                                                    </div>
                                                </td>
                                            </tr>
                                            }
                                            
                                        </tbody>
                                    </table>
                                    <div class="modal fade" tabindex="-1" [attr.id]="'editAcuerdoModal'">
                                                <div class="modal-dialog modal-xl modal-dialog-scrollable">
                                                    <div class="modal-content">
                                                        <form [formGroup]="editAcuerdoForm"
                                                            (ngSubmit)="onEditAcuerdo()">
                                                            <div class="modal-header">
                                                                <button type="button" class="btn-close"
                                                                    data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-title">Edición del acuerdo</div>
                                                            <div class="modal-body overflow-scroll"
                                                                style="max-height: 70vh;">
                                                                <div class="my-2">
                                                                    <div class="p-4">
                                                                        <p>Título</p>
                                                                        <input type="text" formControlName="titulo"
                                                                            class="form-control">
                                                                    </div>
                                                                    <div class="p-4">
                                                                        <p>URL</p>
                                                                        <input type="url" formControlName="link"
                                                                            class="form-control">
                                                                    </div>
                                                                    <div class="p-4">
                                                                        <p>Vigencia</p>
                                                                        <select formControlName="vigente"
                                                                            class="form-select">
                                                                            <option [value]="true">Acuerdo
                                                                                Vigente</option>
                                                                            <option [value]="false">Acuerdo no
                                                                                Vigente</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer mt-4">
                                                                <button type="button" class="btn btn-outline-primary"
                                                                    data-bs-dismiss="modal">
                                                                    Cancelar
                                                                </button>
                                                                <button type="submit" class="btn btn-primary"
                                                                    data-bs-dismiss="modal">
                                                                    Actualizar acuerdo
                                                                </button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                    } @else {
                                    <div class="p-4">
                                        Aun no se han registrado acuerdos para este plan de estudio.
                                    </div>
                                    }
                                </div>
                            </div>
                        </div>


                    </div>
                </div>

            </div>

            }

        </div>

    </div>


</main>


@if (isLoading) {
<app-loading></app-loading>
}